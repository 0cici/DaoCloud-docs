---
hide:
  - toc
---

# 网卡规划

本章节主要介绍在创建工作负载集群前，基于不同网络方案组合如何进行网卡规划。请在集群部署之前完成[集群部署规划](../../install/commercial/deploy-plan.md)及网卡规划。

## 仅使用 Overlay CNI 方案

当集群内的应用 Pod 仅需要使用单一 CNI ，并且不需要提供对外访问时，仅需部署组件`Calico`/`Cilium`，网卡规划也较简单，具体网卡规划如下：

| 部署环境       | 基础设施                       | 网卡数                           | 网卡说明                                                     | 用途                                                         |
| -------------- | ------------------------------ | -------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| POC 环境<br /> | 物理机<br />虚拟机<br />公有云 | **1** 张物理网卡/ Bond 网卡      | **网卡 1**：Access 模式接入，默认路由所在网卡<br />注：建议所有节点网卡名称一致 | **网卡 1**：承载 Kubernetes 管理流量；<br />Calico Pod 流量；<br /> |
| 生产环境<br /> | 物理机<br />虚拟机<br />公有云 | **1 或 2** 张物理网卡/ Bond 网卡 | **网卡 1**：Access 模式接入，默认路由所在网卡<br />**网卡 2（可选）**：Access 模式接入<br />注：<br />1. 建议所有节点网卡名称一致<br /><br />2. 如使用 Hwameistor 本地存储并开启高可用功能，可根据实际场景额外规划网卡 | **网卡 1**：<br />承载 Kubernetes 管理流量；<br />Calico Pod 流量；<br />**网卡 2**：<br />Hwameistor 数据副本跨节点同步流量 |

## Overlay 搭配 Underlay 方案

当集群部署应用需要使用多 CNI 组合，并需要使用 Underlay CNI（Macvlan/SRI-OV） IP 提供对外通信时，可采用的网络组件组合为`Calico+ SpiderPool+ Multus+Macvlan/SRIOV`（同一集群可同时部署 Macvlan 和 SRIOV CNI ），具体的网卡规划如下：

| 部署环境        | 基础设施                 | 网卡数                      | 网卡说明                                                     | 用途                                                         |
   | --------------- | ------------------------ | --------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
   | POC 环境        | 物理机<br />虚拟机<br /> | **1** 张物理网卡/ Bond 网卡 | **网卡 1**：Access 模式接入，默认路由所在网卡<br />注：建议所有节点网卡名称一致 | **网卡 1**：承载 Kubernetes 管理流量；<br />Calico Pod 流量；<br />Underlay CNI （Macvlan）Pod 流量 |
   | 生产 环境<br /> | 物理机<br />虚拟机<br /> | **2** 张物理网卡/ Bond 网卡 | **网卡 1**：Access 模式接入，默认路由所在网卡<br />**网卡 2**：Trunk 模式接入<br />注：建议所有节点网卡名称一致 | **网卡 1**：承载 Kubernetes 管理流量；<br />Calico Pod 流量；<br />**网卡 2**：Underlay CNI （Macvlan/SRI-OV）Pod 流量 |
   | 生产环境<br />  | 物理机<br />虚拟机<br /> | **3** 张物理网卡/ Bond 网卡 | **网卡 1**：Access 模式接入，默认路由所在网卡<br />**网卡 2**：Trunk 模式接入<br />**网卡 3（可选）**：Access 模式接入<br />注：<br />1. 建议所有节点网卡名称一致<br /><br />2. 如使用 Hwameistor 本地存储并开启高可用功能，可根据实际场景额外规划网卡 | **网卡 1**：承载 Kubernetes 管理流量；<br />Calico Pod 流量；<br />**网卡 2**：Underlay CNI （Macvlan/SRI-OV）Pod 流量**网卡 3：<br />Hwameistor 数据副本跨节点同步流量 |

### 网络规划

基于上述的 Overlay CNI + Underlay CNI 网卡规划的最佳实践，集群的网络规划如下：

![网络规划](../images/networkplan.jpg)

**规划说明**：

- 在此规划中默认 CNI 为 Calico/Cilium，需要配合安装 Multus-underlay 、Spiderpool 等组件安装
- 建议所有节点都具备多张物理网卡且网卡名称都一致。
- eth0 为主机默认路由所在网卡，网关指向 Gateway 主机，由该主机转发到外部网络。
  主要用途为：`节点间的通讯`、`Kubernetes 管理网卡`、`Calico Pod 通信`。
- eth1 为 Underlay 业务网卡，无需设置 IP地址， 基于 eth1 创建 VLAN 子接口(Eth1.1、Eth1.2) ，对应网段如：172.16.15.0/24 和 172.16.16.0/24，创建的业务应用 Pod 使用对应网段地址，可满足多 VLAN 多子网场景。
